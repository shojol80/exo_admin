(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1cdd4cfe"],{2781:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t._self._c;return e("waiter",{ref:"waiter"},[e("ValidationObserver",{ref:"observer",scopedSlots:t._u([{key:"default",fn:function(n){var a=n.invalid;return[e("action-toolbar",[e("action-group",{staticClass:"mr-2"},[e("action-back"),e("action-group-separator"),e("ValidationProvider",{attrs:{rules:"required",name:"title",slim:""},scopedSlots:t._u([{key:"default",fn:function(n){var a=n.valid,i=n.errors;return e("action-input",{ref:"name",attrs:{valid:a,errors:i,readonly:""},model:{value:t.site.site_name,callback:function(e){t.$set(t.site,"site_name",e)},expression:"site.site_name"}})}}],null,!0)}),e("action-button",{attrs:{title:"Save",icon:t.$icons.save,shortkey:"['ctrl', 's']",disabled:a},on:{action:t.save}}),e("action-button",{attrs:{title:"Reload",icon:t.$icons.reload},on:{action:t.load}})],1)],1),e("b-tabs",{staticClass:"x-tabs"},[e("b-tab",{attrs:{active:""}},[e("template",{slot:"title"},[e("icon",{attrs:{icon:t.$icons.properties}}),t._v("\n                    Properties\n                ")],1),e("x-form-input",{attrs:{title:"Site ID","db-field":"site_id",readonly:""},model:{value:t.site.site_id,callback:function(e){t.$set(t.site,"site_id",e)},expression:"site.site_id"}}),e("x-form-input",{attrs:{title:"Alias","db-field":"site_alias",readonly:""},model:{value:t.site.site_alias,callback:function(e){t.$set(t.site,"site_alias",e)},expression:"site.site_alias"}})],2),e("b-tab",{scopedSlots:t._u([{key:"title",fn:function(){return[e("icon",{attrs:{icon:t.$icons.variables}}),t._v("\n                    Variables\n                ")]},proxy:!0}],null,!0)},[e("x-vars-editor",{ref:"vars",attrs:{var_parent:t.site.site_id,var_type:"site"}})],1)],1)]}}])})],1)},i=[],o=(n("551c"),n("ac6a"),n("cadf"),n("5df3"),n("f385")),s=n("8b0a"),r=n("91f6"),l={name:"Site",mixins:[s["a"]],components:{EntityDomainList:o["a"]},data:function(){return{site:{vars:[]}}},computed:{},mounted:function(){this.load()},methods:{load:function(){var t=this;this.$refs.waiter.wait(r["a"].getCurrentSite().then((function(e){return t.site=e})).then(this.loadNested))},loadNested:function(){return Promise.all([this.$refs.vars.load()])},save:function(){var t=this;this.$refs.observer.validate().then((function(e){e&&t.$refs.waiter.wait(t.$refs.vars.save())}))}}},c=l,u=(n("cc2d"),n("2877")),d=Object(u["a"])(c,a,i,!1,null,"f92315fc",null);e["default"]=d.exports},"49b6":function(t,e,n){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",[e("a",{staticClass:"mr-2",class:{"text-muted":1==t.domain.is_readonly},attrs:{href:"https://"+t.domain.domain_name,target:"_blank"}},[t._v(t._s(t.domain.domain_name))]),1===t.domain.domain_ismain?e("span",{staticClass:"badge badge-danger mr-2"},[t._v("main")]):t._e(),1===t.domain.domain_isdefault?e("span",{staticClass:"badge badge-secondary"},[t._v("default")]):t._e()])},i=[],o={name:"DomainName",props:{domain:Object}},s=o,r=n("2877"),l=Object(r["a"])(s,a,i,!1,null,null,null);e["a"]=l.exports},7168:function(t,e,n){"use strict";n("ab6d")},"8b0a":function(t,e,n){"use strict";e["a"]={computed:{showDeprecated:function(){return this.$store.getters["site/getSiteVarValue"]("show_deprecated_feature")}}}},ab6d:function(t,e,n){},b261:function(t,e,n){},cc2d:function(t,e,n){"use strict";n("dce9")},dce9:function(t,e,n){},e2cc:function(t,e,n){"use strict";n("b261")},f385:function(t,e,n){"use strict";n("b54a");var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"domain-list"},[e("b-list-group",t._l(t.domains,(function(n){return e("b-list-group-item",{key:n.domain_id,staticClass:"d-flex justify-content-between align-items-center"},[e("domain-name",{attrs:{domain:n}}),e("action-group",{staticClass:"domain-list__actions"},[1!==+n.domain_isdefault?e("action-button",{attrs:{title:"Set domain default",icon:t.$icons.pin},on:{action:function(e){return t.onActionDefault(n)}}}):t._e(),1!==+n.is_readonly?e("action-button",{attrs:{title:"Unlink domain",icon:t.$icons.unlink},on:{action:function(e){return t.onActionUnlink(n)}}}):t._e()],1)],1)})),1),e("action-group",{staticClass:"mt-1"},[e("action-button",{attrs:{title:"Link domain",icon:t.$icons.link},on:{action:function(e){return t.onActionLink()}}})],1),e("link-domain-modal",{ref:"modal",attrs:{domains:t.availableDomains,"parent-domains":t.allDomains}})],1)},i=[],o=(n("8e6e"),n("ac6a"),n("cadf"),n("456d"),n("75fc")),s=n("bd86"),r=(n("96cf"),n("3b8d")),l=(n("f559"),function(){var t=this,e=t._self._c;return e("b-modal",{ref:"modal",attrs:{"modal-class":"modal-primary modal-min-btn link-domain-modal",title:t.title,"hide-header-close":"",centered:"","cancel-title":"CANCEL","cancel-variant":"light","ok-title":"OK","ok-variant":"primary"},on:{cancel:t.onCancel,ok:t.onSave},model:{value:t.isOpen,callback:function(e){t.isOpen=e},expression:"isOpen"}},[e("waiter",{ref:"waiter"},[e("div",[e("b-tabs",{attrs:{fill:""},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[e("b-tab",{attrs:{title:"Select domain",active:""}},[e("p"),e("x-select",{attrs:{clearable:!1,multiple:!1,options:t.domains,valueFormat:"object","id-key":"domain_id","label-key":"domain_name"},model:{value:t.selectedDomain,callback:function(e){t.selectedDomain=e},expression:"selectedDomain"}})],1),e("b-tab",{attrs:{title:"Add new subdomain"}},[e("ValidationObserver",{ref:"observer",scopedSlots:t._u([{key:"default",fn:function(n){n.invalid;var a=n.errors;return[e("p"),e("div",{staticClass:"link-domain-modal__subdomain"},[e("div",[e("ValidationProvider",{attrs:{rules:t.ruleObject,name:"subdomain",debounce:200},scopedSlots:t._u([{key:"default",fn:function(n){n.valid;var a=n.errors;return[e("b-input",{staticClass:"link-domain-modal__subdomain-value",attrs:{state:!a[0]&&null},model:{value:t.subdomainValue,callback:function(e){t.subdomainValue=e},expression:"subdomainValue"}})]}}],null,!0)})],1),e("span",{staticClass:"px-1"},[t._v(".")]),e("x-select",{attrs:{clearable:!1,multiple:!1,options:t.parentDomains,valueFormat:"object","id-key":"domain_id","label-key":"domain_name"},model:{value:t.subdomainParent,callback:function(e){t.subdomainParent=e},expression:"subdomainParent"}})],1),e("div",{staticClass:"mt-2"},t._l(a,(function(n,a){return e("p",{key:a,staticClass:"text-danger"},[t._l(n,(function(n,a){return[e("span",{key:a},[t._v("\n                                    "+t._s(n)+"\n                                ")]),e("br")]}))],2)})),0)]}}])})],1)],1)],1)])],1)}),c=[],u=(n("551c"),n("7219")),d={name:"LinkDomainModal",props:{modalProps:{},title:{default:"Domains"},open:!1,domains:Array,parentDomains:Array},data:function(){return{ruleObject:{required:!0,regex:/^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?$/},selectedDomain:null,subdomainValue:null,subdomainParent:null,isOpen:!1,activeTab:0}},computed:{},watch:{open:function(t){t&&(this.isOpen=!0)},parentDomains:function(t){this.subdomainParent=t[0]},domains:function(t){this.selectedDomain=t[0]}},methods:{show:function(){var t=this;return this.subdomainValue="",new Promise((function(e){t.resolve=e,t.default?t.value=t.default:t.value=null,t.$refs.modal.show()}))},onCancel:function(t){this.resolve(!1)},onSave:function(t){var e=this;this.resolve&&(1===this.activeTab?(t.preventDefault(),this.$refs.waiter.wait(this.$refs.observer.validate().then((function(t){if(t)return u["a"].validateSubdomain({subdomain:e.subdomainValue+"."+e.subdomainParent.domain_name})})).then((function(t){if(t.length)e.$refs.observer.setErrors({subdomain:t});else{var n={subdomainValue:e.subdomainValue,subdomainParent:e.subdomainParent};e.isOpen=!1,e.resolve(n)}})))):this.resolve(this.selectedDomain))}}},m=d,f=(n("7168"),n("2877")),b=Object(f["a"])(m,l,c,!1,null,null,null),p=b.exports,v=n("49b6"),_=n("6c46");function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){Object(s["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var y={name:"EntityDomainList",mixins:[_["a"]],components:{LinkDomainModal:p,DomainName:v["a"]},model:{prop:"domains",event:"change"},props:{domains:{type:Array,required:!0}},data:function(){return{}},computed:{allDomains:function(){return this.$store.state.pages.domains},availableDomains:function(){var t=this;return this.allDomains.filter((function(e){return!e.domain_name.startsWith("webmail")&&!t.domains.some((function(t){return t.domain_id===e.domain_id}))}))}},methods:{onActionLink:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=1,this.$refs.modal.show();case 1:if(e=t.sent,e){t.next=2;break}return t.abrupt("return",!1);case 2:n=k({},e),n.subdomainValue&&(n={domain_id:-this.genID(),domain_name:e.subdomainValue+"."+e.subdomainParent.domain_name}),n.domain_isdefault=0===this.domains.length?1:0,this.$emit("change",[].concat(Object(o["a"])(this.domains),[n]));case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),onActionUnlink:function(t){var e=this.domains.filter((function(e){return e.domain_id!==t.domain_id}));this.$emit("change",e)},onActionDefault:function(t){var e=this.domains.map((function(e){return e.domain_isdefault=e.domain_id===t.domain_id?1:0,e}));this.$emit("change",e)}}},g=y,O=(n("e2cc"),Object(f["a"])(g,a,i,!1,null,"b58300b4",null));e["a"]=O.exports}}]);
//# sourceMappingURL=chunk-1cdd4cfe.5bf164f9.js.map