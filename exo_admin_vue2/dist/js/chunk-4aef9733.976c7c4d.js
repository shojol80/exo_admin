(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4aef9733"],{"1b67":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e._self._c;return t("waiter",{ref:"waiter"},[t("ValidationObserver",{ref:"observer",scopedSlots:e._u([{key:"default",fn:function(n){var i=n.invalid;return[t("action-toolbar",[t("action-group",{staticClass:"mr-2"},[t("action-back"),t("action-group-separator"),t("ValidationProvider",{attrs:{rules:"required",name:"title",slim:""},scopedSlots:e._u([{key:"default",fn:function(n){var i=n.valid,a=n.errors;return[t("action-input",{ref:"name",attrs:{valid:i,errors:a},model:{value:e.edition.e_title,callback:function(t){e.$set(e.edition,"e_title",t)},expression:"edition.e_title"}})]}}],null,!0)}),t("action-button",{attrs:{title:"Save",icon:e.$icons.save,shortkey:"['ctrl', 's']",disabled:i},on:{action:e.save}}),t("action-button",{attrs:{title:"Reload",icon:e.$icons.reload,disabled:"new"===e.e_id},on:{action:e.load}})],1)],1),t("b-tabs",{staticClass:"x-tabs"},[t("b-tab",{attrs:{active:""},scopedSlots:e._u([{key:"title",fn:function(){return[t("icon",{attrs:{icon:e.$icons.properties}}),e._v("\n                    Properties\n                ")]},proxy:!0}],null,!0)},[t("x-form-input",{attrs:{title:"Edition ID","db-field":"e_id",readonly:""},model:{value:e.edition.e_id,callback:function(t){e.$set(e.edition,"e_id",t)},expression:"edition.e_id"}}),t("x-form-group",{attrs:{title:"Domains"}},[t("entity-domain-list",{model:{value:e.edition.domains,callback:function(t){e.$set(e.edition,"domains",t)},expression:"edition.domains"}})],1),t("x-form-switch",{attrs:{title:"Site is closed for visitors","db-field":"e_isclosed"},model:{value:e.edition.e_isclosed,callback:function(t){e.$set(e.edition,"e_isclosed",t)},expression:"edition.e_isclosed"}})],1),t("b-tab",{scopedSlots:e._u([{key:"title",fn:function(){return[t("icon",{attrs:{icon:e.$icons.variables}}),e._v("\n                    Variables\n                ")]},proxy:!0}],null,!0)},[t("vars-editor",{model:{value:e.edition.vars,callback:function(t){e.$set(e.edition,"vars",t)},expression:"edition.vars"}})],1)],1)]}}])})],1)},a=[],o=(n("a481"),n("96cf"),n("3b8d")),r=(n("7f7f"),n("c5f6"),n("f385")),s=n("b991"),c=n("8b0a"),l=n("e6a4"),u=n("9466"),d={name:"Edition",mixins:[c["a"]],components:{VarsEditor:u["a"],EntityDomainList:r["a"]},props:{e_id:[String,Number]},data:function(){return{edition:{e_id:null,e_isclosed:0,e_title:null,e_info:null,vars:[],domains:[]}}},watch:{e_id:function(e,t){e!==t&&this.load()}},mounted:function(){this.load()},methods:{new:function(){var e=this;this.edition.e_title="New edition",this.$nextTick((function(){e.$refs.name.focus()}))},load:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.e_id||"new"!==this.e_id){e.next=1;break}return this.new(),e.abrupt("return");case 1:return e.next=2,this.$refs.waiter.wait(Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=1,l["a"].getEdition({e_id:t.e_id});case 1:t.edition=e.sent;case 2:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),save:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=1,this.$refs.observer.validate();case 1:if(t=e.sent,t){e.next=2;break}return e.abrupt("return");case 2:return e.next=3,this.$refs.waiter.wait(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=1,l["a"].saveEdition(n.edition);case 1:if(i=e.sent,"new"!==n.e_id){e.next=3;break}return e.next=2,n.$router.replace({name:s["m"],params:{e_id:i.e_id}});case 2:e.next=4;break;case 3:return e.next=4,n.load();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},m=d,f=(n("1ffb"),n("2877")),b=Object(f["a"])(m,i,a,!1,null,"d91850ec",null);t["default"]=b.exports},"1ffb":function(e,t,n){"use strict";n("575f")},"49b6":function(e,t,n){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("a",{staticClass:"mr-2",class:{"text-muted":1==e.domain.is_readonly},attrs:{href:"https://"+e.domain.domain_name,target:"_blank"}},[e._v(e._s(e.domain.domain_name))]),1===e.domain.domain_ismain?t("span",{staticClass:"badge badge-danger mr-2"},[e._v("main")]):e._e(),1===e.domain.domain_isdefault?t("span",{staticClass:"badge badge-secondary"},[e._v("default")]):e._e()])},a=[],o={name:"DomainName",props:{domain:Object}},r=o,s=n("2877"),c=Object(s["a"])(r,i,a,!1,null,null,null);t["a"]=c.exports},"575f":function(e,t,n){},7168:function(e,t,n){"use strict";n("ab6d")},"8b0a":function(e,t,n){"use strict";t["a"]={computed:{showDeprecated:function(){return this.$store.getters["site/getSiteVarValue"]("show_deprecated_feature")}}}},ab6d:function(e,t,n){},b261:function(e,t,n){},e2cc:function(e,t,n){"use strict";n("b261")},f385:function(e,t,n){"use strict";n("b54a");var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"domain-list"},[t("b-list-group",e._l(e.domains,(function(n){return t("b-list-group-item",{key:n.domain_id,staticClass:"d-flex justify-content-between align-items-center"},[t("domain-name",{attrs:{domain:n}}),t("action-group",{staticClass:"domain-list__actions"},[1!==+n.domain_isdefault?t("action-button",{attrs:{title:"Set domain default",icon:e.$icons.pin},on:{action:function(t){return e.onActionDefault(n)}}}):e._e(),1!==+n.is_readonly?t("action-button",{attrs:{title:"Unlink domain",icon:e.$icons.unlink},on:{action:function(t){return e.onActionUnlink(n)}}}):e._e()],1)],1)})),1),t("action-group",{staticClass:"mt-1"},[t("action-button",{attrs:{title:"Link domain",icon:e.$icons.link},on:{action:function(t){return e.onActionLink()}}})],1),t("link-domain-modal",{ref:"modal",attrs:{domains:e.availableDomains,"parent-domains":e.allDomains}})],1)},a=[],o=(n("8e6e"),n("ac6a"),n("cadf"),n("456d"),n("75fc")),r=n("bd86"),s=(n("96cf"),n("3b8d")),c=(n("f559"),function(){var e=this,t=e._self._c;return t("b-modal",{ref:"modal",attrs:{"modal-class":"modal-primary modal-min-btn link-domain-modal",title:e.title,"hide-header-close":"",centered:"","cancel-title":"CANCEL","cancel-variant":"light","ok-title":"OK","ok-variant":"primary"},on:{cancel:e.onCancel,ok:e.onSave},model:{value:e.isOpen,callback:function(t){e.isOpen=t},expression:"isOpen"}},[t("waiter",{ref:"waiter"},[t("div",[t("b-tabs",{attrs:{fill:""},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("b-tab",{attrs:{title:"Select domain",active:""}},[t("p"),t("x-select",{attrs:{clearable:!1,multiple:!1,options:e.domains,valueFormat:"object","id-key":"domain_id","label-key":"domain_name"},model:{value:e.selectedDomain,callback:function(t){e.selectedDomain=t},expression:"selectedDomain"}})],1),t("b-tab",{attrs:{title:"Add new subdomain"}},[t("ValidationObserver",{ref:"observer",scopedSlots:e._u([{key:"default",fn:function(n){n.invalid;var i=n.errors;return[t("p"),t("div",{staticClass:"link-domain-modal__subdomain"},[t("div",[t("ValidationProvider",{attrs:{rules:e.ruleObject,name:"subdomain",debounce:200},scopedSlots:e._u([{key:"default",fn:function(n){n.valid;var i=n.errors;return[t("b-input",{staticClass:"link-domain-modal__subdomain-value",attrs:{state:!i[0]&&null},model:{value:e.subdomainValue,callback:function(t){e.subdomainValue=t},expression:"subdomainValue"}})]}}],null,!0)})],1),t("span",{staticClass:"px-1"},[e._v(".")]),t("x-select",{attrs:{clearable:!1,multiple:!1,options:e.parentDomains,valueFormat:"object","id-key":"domain_id","label-key":"domain_name"},model:{value:e.subdomainParent,callback:function(t){e.subdomainParent=t},expression:"subdomainParent"}})],1),t("div",{staticClass:"mt-2"},e._l(i,(function(n,i){return t("p",{key:i,staticClass:"text-danger"},[e._l(n,(function(n,i){return[t("span",{key:i},[e._v("\n                                    "+e._s(n)+"\n                                ")]),t("br")]}))],2)})),0)]}}])})],1)],1)],1)])],1)}),l=[],u=(n("551c"),n("7219")),d={name:"LinkDomainModal",props:{modalProps:{},title:{default:"Domains"},open:!1,domains:Array,parentDomains:Array},data:function(){return{ruleObject:{required:!0,regex:/^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?$/},selectedDomain:null,subdomainValue:null,subdomainParent:null,isOpen:!1,activeTab:0}},computed:{},watch:{open:function(e){e&&(this.isOpen=!0)},parentDomains:function(e){this.subdomainParent=e[0]},domains:function(e){this.selectedDomain=e[0]}},methods:{show:function(){var e=this;return this.subdomainValue="",new Promise((function(t){e.resolve=t,e.default?e.value=e.default:e.value=null,e.$refs.modal.show()}))},onCancel:function(e){this.resolve(!1)},onSave:function(e){var t=this;this.resolve&&(1===this.activeTab?(e.preventDefault(),this.$refs.waiter.wait(this.$refs.observer.validate().then((function(e){if(e)return u["a"].validateSubdomain({subdomain:t.subdomainValue+"."+t.subdomainParent.domain_name})})).then((function(e){if(e.length)t.$refs.observer.setErrors({subdomain:e});else{var n={subdomainValue:t.subdomainValue,subdomainParent:t.subdomainParent};t.isOpen=!1,t.resolve(n)}})))):this.resolve(this.selectedDomain))}}},m=d,f=(n("7168"),n("2877")),b=Object(f["a"])(m,c,l,!1,null,null,null),p=b.exports,v=n("49b6"),h=n("6c46");function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w={name:"EntityDomainList",mixins:[h["a"]],components:{LinkDomainModal:p,DomainName:v["a"]},model:{prop:"domains",event:"change"},props:{domains:{type:Array,required:!0}},data:function(){return{}},computed:{allDomains:function(){return this.$store.state.pages.domains},availableDomains:function(){var e=this;return this.allDomains.filter((function(t){return!t.domain_name.startsWith("webmail")&&!e.domains.some((function(e){return e.domain_id===t.domain_id}))}))}},methods:{onActionLink:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=1,this.$refs.modal.show();case 1:if(t=e.sent,t){e.next=2;break}return e.abrupt("return",!1);case 2:n=k({},t),n.subdomainValue&&(n={domain_id:-this.genID(),domain_name:t.subdomainValue+"."+t.subdomainParent.domain_name}),n.domain_isdefault=0===this.domains.length?1:0,this.$emit("change",[].concat(Object(o["a"])(this.domains),[n]));case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onActionUnlink:function(e){var t=this.domains.filter((function(t){return t.domain_id!==e.domain_id}));this.$emit("change",t)},onActionDefault:function(e){var t=this.domains.map((function(t){return t.domain_isdefault=t.domain_id===e.domain_id?1:0,t}));this.$emit("change",t)}}},x=w,g=(n("e2cc"),Object(f["a"])(x,i,a,!1,null,"b58300b4",null));t["a"]=g.exports}}]);
//# sourceMappingURL=chunk-4aef9733.976c7c4d.js.map