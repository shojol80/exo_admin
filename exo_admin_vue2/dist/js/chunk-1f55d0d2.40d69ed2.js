(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1f55d0d2"],{"04ef":function(e,t,r){"use strict";var i=function(){var e=this,t=e._self._c;return t("vue-query-builder",e._g(e._b({staticClass:"x-query-builder",scopedSlots:e._u([e._l(e.$scopedSlots,(function(t,r){return{key:r,fn:function(t){return[e._t(r,null,null,t)]}}}))],null,!0)},"vue-query-builder",e.$attrs,!1),e.$listeners),[e._l(e.$slots,(function(t,r){return e._t(r,null,{slot:r})}))],2)},u=[],n=(r("54d8"),r("9a97")),l=r.n(n),s={name:"XQueryBuilder",components:{VueQueryBuilder:l.a}},o=s,a=(r("cfc4"),r("2877")),c=Object(a["a"])(o,i,u,!1,null,null,null);t["a"]=c.exports},"1ec3":function(e,t,r){},"1ecc":function(e,t,r){"use strict";r("1ec3")},"4ba2":function(e,t,r){},"54d6":function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"controller-actions"},[t("waiter",{ref:"waiter"},[t("action-toolbar",[t("action-group",[t("action-back",{attrs:{"back-route":e.backRoute}}),t("action-button",{attrs:{title:"Save",icon:e.$icons.save,shortkey:"['ctrl', 's']"},on:{action:e.save}}),t("action-button",{attrs:{title:"Reload",icon:e.$icons.reload},on:{action:e.load}})],1)],1),t("div",{staticClass:"mt-3"},[t(e.ruleComponent,{tag:"component"})],1)],1)],1)},u=[],n=(r("96cf"),r("3b8d")),l=function(){var e=this,t=e._self._c;return t("b-card",[t("x-form-switch",{attrs:{values:"boolean",title:"Use this page as redir page"},model:{value:e.rule_use_for_redir,callback:function(t){e.rule_use_for_redir=t},expression:"rule_use_for_redir"}}),t("x-form-group",{attrs:{title:"Redir to this page when"}},[t("rule-builder")],1),t("x-form-input",{attrs:{title:"Add params to URL",description:"use substitution: {react_id},{[react_field_name]},{user_hash_login}"},model:{value:e.rule_redir_param,callback:function(t){e.rule_redir_param=t},expression:"rule_redir_param"}})],1)},s=[],o=r("9ea0"),a={computed:{form:function(){var e=this.$store.getters["controller/getActionFormId"];return e?this.$store.getters["forms/getForm"](e):void 0},form_questions:function(){return this.form.form_questions},fqtArrayId:function(){return this.$store.getters["ECO/fqtArrayId"]},rules:function(){return this.$store.getters["controller/formActions/rules"]}}},c=r("115e"),f={name:"RedirectFormActions",mixins:[a],components:{RuleBuilder:o["a"]},data:function(){return{}},computed:{rule_use_for_redir:{get:function(){return!Object(c["a"])(this.rules["rule_use_for_redir"])&&this.rules["rule_use_for_redir"]},set:function(e){this.$store.commit("controller/formActions/setRule",{rule:"rule_use_for_redir",value:e})}},rule_redir_param:{get:function(){return Object(c["a"])(this.rules["rule_redir_param"])?"":this.rules["rule_redir_param"]},set:function(e){this.$store.commit("controller/formActions/setRule",{rule:"rule_redir_param",value:e})}},rule_redir_event:{get:function(){return Object(c["a"])(this.rules["rule_redir_event"])?void 0:this.rules["rule_redir_event"]},set:function(e){this.$store.commit("controller/formActions/setRule",{rule:"rule_redir_event",value:e})}}}},_=f,d=r("2877"),m=Object(d["a"])(_,l,s,!1,null,"3d05af62",null),p=m.exports,h=function(){var e=this,t=e._self._c;return t("b-card",[t("x-form-radio-group",{attrs:{title:"Send to",options:e.sendToOptions},model:{value:e.rule_send_type,callback:function(t){e.rule_send_type=t},expression:"rule_send_type"}}),"fields"===e.rule_send_type?t("x-form-select",{attrs:{title:"Recipient fields",description:"Select fields which will contain recipient email or user group name","id-key":"fq_name","label-key":"fq_name",multiple:!0,options:e.form_questions},model:{value:e.rule_send_fields,callback:function(t){e.rule_send_fields=t},expression:"rule_send_fields"}}):"email"===e.rule_send_type?t("x-form-input",{attrs:{title:"Email",description:"Specify the recipient's email address or a comma-separated list of emails"},model:{value:e.rule_send_email,callback:function(t){e.rule_send_email=t},expression:"rule_send_email"}}):t("x-form-group",{attrs:{title:"User groups"}},[t("select-usergroup",{attrs:{multiple:!0},model:{value:e.rule_send_groups,callback:function(t){e.rule_send_groups=t},expression:"rule_send_groups"}})],1),t("x-form-switch",{attrs:{title:"Use linked images"},model:{value:e.rule_image_linked,callback:function(t){e.rule_image_linked=t},expression:"rule_image_linked"}}),t("x-form-group",{attrs:{title:"Send mail when"}},[t("rule-builder")],1),t("x-form-group",{attrs:{title:"Send fields as attachment"}},[e.attach_fields.length>0?e._l(e.attach_fields,(function(r){return t("x-form-control-switch",{key:r.fq_name,attrs:{values:"boolean",value:e.getFileAttachValue(r.fq_name)},on:{change:function(t){return e.setFileAttachValue(r.fq_name,t)}}},[e._v("\n                "+e._s(r.fq_name)+"\n            ")])})):[t("p",{staticClass:"text-muted empty-attach"},[e._v('This form doesn\'t contain "file" fields')])]],2)],1)},g=[],v=r("75fc"),b=(r("6762"),r("2fdb"),r("28a5"),{name:"MailFormActions",mixins:[a],components:{RuleBuilder:o["a"]},data:function(){return{sendToOptions:[{text:"Fields",value:"fields"},{text:"Email",value:"email"},{text:"User groups",value:"usergroups"}]}},computed:{rule_send_type:{get:function(){return Object(c["a"])(this.rules["rule_send_type"])?"fields":this.rules["rule_send_type"]},set:function(e){this.$store.commit("controller/formActions/setRule",{rule:"rule_send_type",value:e})}},rule_send_email:{get:function(){return Object(c["a"])(this.rules["rule_send_email"])?"":this.rules["rule_send_email"]},set:function(e){this.$store.commit("controller/formActions/setRule",{rule:"rule_send_email",value:e})}},rule_send_fields:{get:function(){return Object(c["a"])(this.rules["rule_send_fields"])?[]:this.rules["rule_send_fields"].split(",")},set:function(e){this.$store.commit("controller/formActions/setRule",{rule:"rule_send_fields",value:e.join(",")})}},rule_send_groups:{get:function(){return Object(c["a"])(this.rules["rule_send_groups"])?[]:this.rules["rule_send_groups"].split(",")},set:function(e){this.$store.commit("controller/formActions/setRule",{rule:"rule_send_groups",value:e.join(",")})}},rule_file_attach:function(){return Object(c["a"])(this.rules["rule_file_attach"])?[]:this.rules["rule_file_attach"]},rule_image_linked:{get:function(){return!Object(c["a"])(this.rules["rule_image_linked"])&&this.rules["rule_image_linked"]},set:function(e){this.$store.commit("controller/formActions/setRule",{rule:"rule_image_linked",value:e})}},attach_fields:function(){var e=this;return!this.form_questions||Object(c["a"])(this.fqtArrayId)?[]:this.form_questions.filter((function(t){return"file"===e.fqtArrayId[t.fq_type].fqt_name}))}},methods:{getFileAttachValue:function(e){return this.rule_file_attach.includes(e)},setFileAttachValue:function(e,t){this.$store.commit("controller/formActions/setRule",{rule:"rule_file_attach",value:t?[].concat(Object(v["a"])(this.rule_file_attach),[e]):this.rule_file_attach.filter((function(t){return t!==e}))})}}}),y=b,q=(r("a5ba"),Object(d["a"])(y,h,g,!1,null,"8b3094a0",null)),x=q.exports,A=r("b991"),O={name:"ControllerActions",components:{MailFormActions:x,RedirectFormActions:p},props:{react_id:{required:!0}},data:function(){return{backRoute:A["e"]}},computed:{ruleComponent:function(){if(this.react.react_form_name)return this.$store.getters["forms/isMailable"](this.react.react_form)?x:p},rulesName:function(){if(this.react.react_form_name)return this.$store.getters["forms/isMailable"](this.react.react_form)?"mail_rules":"redir_rules"},react:function(){var e=this.$store.getters["controller/getItem"](this.react_id);return e?e.react:{}},form:function(){return this.$store.getters["forms/getForm"](this.react.react_form)}},watch:{rulesName:{handler:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=1,this.load();case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},mounted:function(){this.load()},methods:{load:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.rulesName){e.next=1;break}return e.abrupt("return");case 1:return e.next=2,this.$refs.waiter.wait(this.$store.dispatch("controller/formActions/loadRules",{react_id:this.react_id,rules_name:this.rulesName}));case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),save:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=1,this.$refs.waiter.wait(this.$store.dispatch("controller/formActions/saveRules",{react_id:this.react_id,rules_name:this.rulesName}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},$=O,w=Object(d["a"])($,i,u,!1,null,null,null);t["default"]=w.exports},8224:function(e,t,r){},"9ea0":function(e,t,r){"use strict";var i=function(){var e=this,t=e._self._c;return t("rule-adapter",{staticClass:"rule-builder",attrs:{rules:e.rulesDefinition,rule_operator:e.rule_operator,"max-depth":3},on:{"update:rule_operator":function(t){e.rule_operator=t}},model:{value:e.rule_if,callback:function(t){e.rule_if=t},expression:"rule_if"}})},u=[],n=r("75fc"),l=function(){var e=this,t=e._self._c;return t("div",[t("b-input",e._g(e._b({directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}]},"b-input",e.$attrs,!1),e.$listeners))],1)},s=[],o=(r("6762"),r("2fdb"),{name:"FieldRuleInput",computed:{show:function(){return!["is EMPTY","is NOT EMPTY","is CHANGED"].includes(this.$parent.query.operator)}}}),a=o,c=r("2877"),f=Object(c["a"])(a,l,s,!1,null,"18eadda3",null),_=f.exports,d=function(){var e=this,t=e._self._c;return t("x-query-builder",e._b({model:{value:e.query,callback:function(t){e.query=t},expression:"query"}},"x-query-builder",e.$attrs,!1))},m=[],p=r("04ef"),h=r("2ef0"),g={"=":"is EQUAL","!=":"is NOT EQUAL",empty:"is EMPTY","!empty":"is NOT EMPTY",changed:"is CHANGED"};function v(e){var t=e.rule_if,r=e.rule_operator;t||(t=[]);var i=t.reduce((function(e,t){return t.rule_if?e.push({type:"query-builder-group",query:v({rule_if:t.rule_if,rule_operator:t.rule_operator})}):"__react"===t.field_name?e.push({type:"query-builder-rule",query:{operand:"REACT",operator:void 0,rule:t.field_name,value:t.exp}}):e.push({type:"query-builder-rule",query:{operand:t.field_name,operator:g[t.exp]||t.exp,rule:"__"+t.field_name,value:t.field_value}}),e}),[]);return{logicalOperator:r,children:i}}var b={"is EQUAL":"=","is NOT EQUAL":"!=","is EMPTY":"empty","is NOT EMPTY":"!empty","is CHANGED":"changed"};function y(e){return e.children.reduce((function(e,t){return"query-builder-group"===t.type?e.push({rule_if:y(t.query),rule_operator:t.query.logicalOperator}):"__react"===t.query.rule?e.push({field_name:t.query.rule,field_value:"",exp:t.query.value}):e.push({field_name:t.query.operand,field_value:t.query.value,exp:b[t.query.operator]||t.query.operator}),e}),[])}var q={name:"RuleAdapter",components:{XQueryBuilder:p["a"]},model:{prop:"rule_if",event:"input"},props:{rule_if:{type:Array,required:!0,default:function(){return[]}},rule_operator:{type:String,required:!0,default:"any"}},data:function(){return{query:{children:null,logicalOperator:null}}},watch:{rule_if:{deep:!0,immediate:!0,handler:function(){var e=v({rule_if:this.rule_if,rule_operator:this.rule_operator});this.query.children=e.children}},rule_operator:{immediate:!0,handler:function(){this.query.logicalOperator=this.rule_operator}},query:function(){var e=y(this.query);Object(h["isEqual"])(e,this.rule_if)||this.$emit("input",e),this.rule_operator!==this.query.logicalOperator&&this.$emit("update:rule_operator",this.query.logicalOperator)}}},x=q,A=Object(c["a"])(x,d,m,!1,null,"16c71e16",null),O=A.exports,$={name:"RuleBuilder",components:{RuleAdapter:O},computed:{rules:function(){return this.$store.getters["controller/formActions/rules"]},rule_if:{get:function(){return this.rules.rule_if},set:function(e){this.$store.commit("controller/formActions/setRule",{rule:"rule_if",value:e})}},rule_operator:{get:function(){return this.rules.rule_operator},set:function(e){this.$store.commit("controller/formActions/setRule",{rule:"rule_operator",value:e})}},form:function(){return this.$store.getters["forms/getForm"](this.$store.getters["controller/getActionFormId"])},form_questions:function(){return this.form?this.form.form_questions:[]},fqtArrayId:function(){return this.$store.getters["ECO/fqtArrayId"]},rulesDefinition:function(){return[{type:"radio",id:"__react",label:"REACT",choices:[{label:"CHANGED",value:"changed"},{label:"DELETED",value:"deleted"}]}].concat(Object(n["a"])(this.form_questions.map((function(e){return{type:"custom-component",id:"__"+e.fq_name,label:e.fq_name,operators:["is EQUAL","is NOT EQUAL","is EMPTY","is NOT EMPTY","is CHANGED",">","<",">=","<="],component:_,default:""}}))))}},data:function(){return{}}},w=$,R=(r("1ecc"),Object(c["a"])(w,i,u,!1,null,null,null));t["a"]=R.exports},a5ba:function(e,t,r){"use strict";r("4ba2")},cfc4:function(e,t,r){"use strict";r("8224")}}]);
//# sourceMappingURL=chunk-1f55d0d2.40d69ed2.js.map