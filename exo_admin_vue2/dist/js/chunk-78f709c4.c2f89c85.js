(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-78f709c4"],{"0475":function(e,t,r){"use strict";var i=function(){var e=this,t=e._self._c;return t("x-query-builder",{staticClass:"react-query-builder",attrs:{labels:e.labels,rules:e.rules,value:e.value},on:{input:function(t){return e.$emit("input",t)}}})},n=[],a=(r("8e6e"),r("cadf"),r("456d"),r("bd86")),s=(r("ac6a"),r("04ef")),l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"field-input"},[t("b-input",e._g(e._b({directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}]},"b-input",e.$attrs,!1),e.$listeners)),t("info-icon",{directives:[{name:"show",rawName:"v-show",value:!!e.help,expression:"!!help"}]},[e._v(e._s(e.help))])],1)},o=[],u=(r("6762"),r("2fdb"),{name:"FieldInput",computed:{operator:function(){return this.$parent.query.operator},show:function(){return!["EMPTY","NOT EMPTY"].includes(this.operator)},help:function(){return["LIKE","NOT LIKE"].includes(this.operator)?'Use %  as wildcard. Example: "Product%"':["IN","NOT IN"].includes(this.operator)?'Use "," as delimiter. Example: "4423,44334,23423"':void 0}}}),c=u,d=(r("9e68"),r("2877")),m=Object(d["a"])(c,l,o,!1,null,"f9692498",null),p=m.exports;function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){Object(a["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var b={name:"ReactQueryBuilder",components:{XQueryBuilder:s["a"]},model:{prop:"value",event:"input"},props:{value:{type:Object,required:!0},forms:{type:Array,required:!0}},data:function(){return{labels:{matchType:"Match Type",matchTypes:[{id:"AND",label:"AND"},{id:"OR",label:"OR"}],addRule:"Add Rule",removeRule:"&times;",addGroup:"Add Group",removeGroup:"&times;",textInputPlaceholder:"value"}}},computed:{rules:function(){var e=this,t=[this.composeFieldRule({id:"react_id",label:"react_id"}),this.composeFieldRule({id:"react_edition_id",label:"react_edition_id"}),this.composeFieldRule({id:"react_form_permalink_id",label:"react_form_permalink_id"}),this.composeFieldRule({id:"form_name",label:"form_name"})];return this.forms.map((function(r){var i=e.$store.getters["forms/getForm"](r),n=[];return i.form_questions.forEach((function(r){t.find((function(e){return e.id===r.fq_name}))||t.push(e.composeFieldRule({id:r.fq_name,label:r.fq_name}))})),n})),t}},methods:{composeFieldRule:function(e){var t=["=","<",">","<=",">=","!=","LIKE","NOT LIKE","EMPTY","NOT EMPTY","IN","NOT IN"];return"permalink"===e.id&&(t=["=","<",">","<=",">=","!=","LIKE","NOT LIKE"]),h({type:"custom-component",component:p,operators:t,default:""},e)}}},v=b,_=(r("5bc6"),Object(d["a"])(v,i,n,!1,null,null,null));t["a"]=_.exports},"04ef":function(e,t,r){"use strict";var i=function(){var e=this,t=e._self._c;return t("vue-query-builder",e._g(e._b({staticClass:"x-query-builder",scopedSlots:e._u([e._l(e.$scopedSlots,(function(t,r){return{key:r,fn:function(t){return[e._t(r,null,null,t)]}}}))],null,!0)},"vue-query-builder",e.$attrs,!1),e.$listeners),[e._l(e.$slots,(function(t,r){return e._t(r,null,{slot:r})}))],2)},n=[],a=(r("54d8"),r("9a97")),s=r.n(a),l={name:"XQueryBuilder",components:{VueQueryBuilder:s.a}},o=l,u=(r("cfc4"),r("2877")),c=Object(u["a"])(o,i,n,!1,null,null,null);t["a"]=c.exports},"5bc6":function(e,t,r){"use strict";r("c2ad")},8224:function(e,t,r){},8965:function(e,t,r){"use strict";var i=function(){var e=this,t=e._self._c;return t("waiter",{ref:"waiter"},[t("div",{staticClass:"send-mailable"},[t("action-toolbar",[e._t("before_actions"),t("action-group",[t("action-button",{attrs:{title:"Send",icon:e.$icons.send,shortkey:"['ctrl', 's']"},on:{action:e.send}})],1)],2),t("b-card",{staticClass:"mt-3 mb-0"},[t("ValidationObserver",{ref:"observer",scopedSlots:e._u([{key:"default",fn:function(r){r.invalid;return[t("ValidationProvider",{attrs:{rules:"",vid:"type"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("x-form-radio-group",{attrs:{title:"Send to",options:e.sendToOptions,labelColsLg:3},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}})]}}],null,!0)}),t("ValidationProvider",{directives:[{name:"show",rawName:"v-show",value:"form"===e.type,expression:"type === 'form'"}],attrs:{name:"form",rules:"required_if:type,form"},scopedSlots:e._u([{key:"default",fn:function(r){r.valid;var i=r.errors;return t("x-form-group",{attrs:{title:"Form",labelColsLg:3}},[t("select-form",{attrs:{"value-format":"object",required:!0,state:!i[0]&&null,forms:!0,filter:function(e){return e.form_questions.some((function(e){return"useremail"===e.type.fqt_name}))}},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}}),t("b-form-invalid-feedback",{attrs:{id:"inputLiveFeedback"}},[e._v("\n                            "+e._s(i[0])+"\n                        ")])],1)}}],null,!0)}),t("ValidationProvider",{directives:[{name:"show",rawName:"v-show",value:"form"===e.type,expression:"type === 'form'"}],attrs:{rules:"required_if:type,form",name:"field"},scopedSlots:e._u([{key:"default",fn:function(r){var i=r.valid,n=r.errors;return t("x-form-select",{attrs:{title:"Field","id-key":"fq_id","label-key":"fq_name",placeholder:"Select a field",valid:i,errors:n,disabled:!e.form,labelColsLg:3,multiple:!1,options:e.form?e.form_val:[]},model:{value:e.mail.fq_id,callback:function(t){e.$set(e.mail,"fq_id",t)},expression:"mail.fq_id"}})}}],null,!0)}),t("ValidationProvider",{directives:[{name:"show",rawName:"v-show",value:"form"===e.type,expression:"type === 'form'"}],attrs:{name:"matchtype"}},[t("x-form-group",{attrs:{title:"Filter",labelColsLg:3}},[t("react-query-builder",{staticClass:"mb-3",class:{"disabled-component":!e.form},attrs:{forms:e.form?[e.form.form_id]:[]},model:{value:e.mail.QBRules,callback:function(t){e.$set(e.mail,"QBRules",t)},expression:"mail.QBRules"}})],1)],1),t("ValidationProvider",{directives:[{name:"show",rawName:"v-show",value:"usergroup"===e.type,expression:"type === 'usergroup'"}],attrs:{rules:"required_if:type,usergroup",name:"usergroup"},scopedSlots:e._u([{key:"default",fn:function(r){var i=r.valid,n=r.errors;return t("x-form-select",{attrs:{title:"Usergroup",options:e.groups,"id-key":"ug_id","label-key":"ug_name",valid:i,errors:n,labelColsLg:3},scopedSlots:e._u([{key:"option-label",fn:function(r){var i=r.node,n=r.shouldShowCount,a=r.count,s=r.labelClassName,l=r.countClassName;return[t("label",{class:s},[e._v("\n                                "+e._s(i.label)+"\n                                "),"1"===i.raw.ug_isnewsletter?t("span",{staticClass:"badge badge-primary"},[e._v("\n                                    Newsletter group\n                                ")]):e._e(),n?t("span",{class:l},[e._v("\n                                    ("+e._s(a)+")\n                                ")]):e._e()])]}}],null,!0),model:{value:e.mail.ug_id,callback:function(t){e.$set(e.mail,"ug_id",t)},expression:"mail.ug_id"}})}}],null,!0)}),t("ValidationProvider",{directives:[{name:"show",rawName:"v-show",value:"email"===e.type,expression:"type === 'email'"}],attrs:{rules:"required_if:type,email|email",name:"email"},scopedSlots:e._u([{key:"default",fn:function(r){var i=r.valid,n=r.errors;return[t("x-form-input",{attrs:{title:"Email address",valid:i,errors:n,labelColsLg:3},model:{value:e.mail.email,callback:function(t){e.$set(e.mail,"email",t)},expression:"mail.email"}})]}}],null,!0)}),t("x-form-group",{staticClass:"x-form-group--padding",attrs:{title:"Recipients",labelColsLg:3}},["..."===e.recipientCount?t("b-spinner",{attrs:{small:"",label:"calculate"}}):t("span",[e._v("\n                         "+e._s(e.recipientCount)+"\n                   ")])],1),t("x-form-input",{attrs:{title:"Subject",placeholder:"Use default from react",labelColsLg:3},model:{value:e.mail.subject,callback:function(t){e.$set(e.mail,"subject",t)},expression:"mail.subject"}}),t("x-form-radio-group",{attrs:{title:"Do you want to schedule or send now?",options:e.scheduleOptions,labelColsLg:3},model:{value:e.sendSchedule,callback:function(t){e.sendSchedule=t},expression:"sendSchedule"}}),t("x-form-date-time",{directives:[{name:"show",rawName:"v-show",value:"schedule"===e.sendSchedule,expression:"sendSchedule === 'schedule'"}],attrs:{title:"Scheduled time to send",config:e.config,labelColsLg:3},model:{value:e.date_scheduled,callback:function(t){e.date_scheduled=t},expression:"date_scheduled"}})]}}])}),t("x-form-text-area",{directives:[{name:"show",rawName:"v-show",value:e.log,expression:"log"}],attrs:{disabled:!0,title:"Log",rows:15,labelColsLg:3},model:{value:e.log,callback:function(t){e.log=t},expression:"log"}})],1)],1)])},n=[],a=(r("96cf"),r("3b8d")),s=r("5a0c"),l=r.n(s),o=r("2c67"),u={send:function(e,t){e.react_id,e.ug_id,e.email,e.fq_id,e.QBRules,e.date_scheduled;return o["a"].post.apply(o["a"],["/mailable/send"].concat(Array.prototype.slice.call(arguments)))},estimatedRecipients:function(e,t){e.ug_id,e.email,e.fq_id,e.QBRules;return o["a"].post.apply(o["a"],["/mailable/estimatedRecipients"].concat(Array.prototype.slice.call(arguments)))}},c=r("0475"),d=r("5f96"),m={name:"SendMailable",components:{ReactQueryBuilder:c["a"]},props:{react_id:{required:!0}},data:function(){return{log:null,recipientCount:0,mail:{react_id:this.react_id,ug_id:null,email:null,subject:null,fq_id:null,QBRules:Object(d["a"])()},date_scheduled:l()().add(0,"h").toISOString(),sendToOptions:[{text:"Single email",value:"email"},{text:"Usergroup",value:"usergroup"},{text:"Form",value:"form"}],scheduleOptions:[{text:"Send now",value:"now"},{text:"Schedule",value:"schedule"}],type:"email",sendSchedule:"now",form:null}},computed:{config:function(){return{allowInput:!0,wrap:!1,enableTime:!0,time_24hr:!0,altInput:!0,altFormat:"d.m.Y H:i",dateFormat:"Z"}},groups:function(){return this.$store.state.usergroups.usergroups},form_val:function(){return this.form.form_questions.filter((function(e){return"useremail"===e.type.fqt_name}))}},watch:{form:function(){this.mail.fq_id=null,this.mail.QBRules=Object(d["a"])()},"mail.ug_id":{handler:function(){this.getEstimatedRecipient()}},"mail.fq_id":{handler:function(){this.getEstimatedRecipient()}},"mail.QBRules":{handler:function(){this.getEstimatedRecipient()},deep:!0},"mail.email":{handler:function(){this.getEstimatedRecipient()}},type:{handler:function(){this.getEstimatedRecipient()}}},methods:{send:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r,i,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.log=null,e.next=1,this.$refs.observer.validate();case 1:if(t=e.sent,t){e.next=2;break}return e.abrupt("return");case 2:if(r={subject:this.mail.subject,react_id:this.mail.react_id},"usergroup"!==this.type||"now"!==this.sendSchedule){e.next=4;break}return e.next=3,this.$dialogs.confirm({message:'You have selected "group" and send "now" for this it is better to use the scheduler. If the group has a large number of recipients it can take a long time and in case of a disconnection not all users get the message.',okTitle:"CONTINUE"});case 3:if(i=e.sent,"ok"===i.trigger){e.next=4;break}return e.abrupt("return");case 4:return"usergroup"===this.type&&(r.ug_id=this.mail.ug_id),"email"===this.type&&(r.email=this.mail.email),"form"===this.type&&(r.fq_id=this.mail.fq_id,r.QBRules=this.mail.QBRules),r.scheduled="now"===this.sendSchedule?null:this.date_scheduled,e.next=5,this.$refs.waiter.wait(Object(a["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=1,u.send(r);case 1:t=e.sent,"now"!==n.sendSchedule?n.$awn.success("Mail sent to the queue"):(n.log=JSON.stringify(t,null,4),t.error_count>0?n.$awn.warning("Errors occurred while sending emails, check logs"):n.$awn.success("Mail sent successfully")),n.$emit("send",t);case 2:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getEstimatedRecipient:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("email"!==this.type){e.next=1;break}return e.abrupt("return",this.recipientCount=1);case 1:if(this.recipientCount="...",t={},"usergroup"!==this.type){e.next=3;break}if(this.mail.ug_id){e.next=2;break}return e.abrupt("return",this.recipientCount=0);case 2:t.ug_id=this.mail.ug_id;case 3:if("form"!==this.type){e.next=5;break}if(this.mail.fq_id){e.next=4;break}return e.abrupt("return",this.recipientCount=0);case 4:t.fq_id=this.mail.fq_id,t.QBRules=this.mail.QBRules;case 5:return e.next=6,u.estimatedRecipients(t);case 6:this.recipientCount=e.sent;case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){this.getEstimatedRecipient()}},p=m,f=(r("93f1"),r("2877")),h=Object(f["a"])(p,i,n,!1,null,"810e4a8a",null);t["a"]=h.exports},9168:function(e,t,r){},"93f1":function(e,t,r){"use strict";r("9168")},"9e68":function(e,t,r){"use strict";r("f9ab")},c2ad:function(e,t,r){},cfc4:function(e,t,r){"use strict";r("8224")},f9ab:function(e,t,r){}}]);
//# sourceMappingURL=chunk-78f709c4.c2f89c85.js.map